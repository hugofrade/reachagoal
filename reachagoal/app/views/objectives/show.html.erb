<p id="notice"><%= notice %></p>

    <section id='challenge'>


      <article class='bigAddSavings'>
        
        
        <div class='background parallax-bg' data-speed='6' data-type='background-parallax' style="background-image: url(<%= @objective.photo.url(:wide) %>)" >
          <div class='container'>
            <div class='row headerChallenge'>
              <div class='col-md-6'>
                <h1 class='h3 challengeTitle'><%= @objective.name %></h1>
                <% if @objective.completed_percentage < 100 %>
                <%= link_to '<i class="fa fa-lg fa-pencil-square-o"></i> Editar'.html_safe, edit_objective_path(@objective), :class => "challengeEdit" if user_signed_in? && @objective.user_id == current_user.id  %>
				<%end%>
              </div>
              <div class='col-md-6'>
                <div class='progressWrap'>
                  <h1 class='h6 progressTitle'>Progresso</h1>
                  <div class='progress'>
                  	<%= bootstrap_progress_bar(@objective.completed_percentage, :color => "info", :class => "progress-bar", :tiny => true) %>
                  </div>
                  <div class='challengeTotal'><%= number_to_currency(@objective.price, :unit => "&euro;".html_safe, :format => "%n %u", :separator => ".", :delimiter => " ", :precision => 2) %></div>
                </div>
              </div>
            </div>
          </div>
          
          
		  <!-- Friends -->
          <div class='container'>
            <div class='row'>
<!--
              <div class='col-md-6'>
                <ul class='challengeFriends'>
                  <li>
                    <a class='friendPicture withTooltip' data-placement='bottom' data-toggle='tooltip' href='javascript:;' title='João Tigre'>
                      <img alt='João Tigre' class='img-responsive' src='images/f04.jpg'>
                    </a>
                  </li>
                  <li>
                    <a class='friendPicture withTooltip' data-placement='bottom' data-toggle='tooltip' href='javascript:;' title='João Tigre'>
                      <img alt='João Tigre' class='img-responsive' src='images/f03.jpg'>
                    </a>
                  </li>
                  <li>
                    <a class='friendPicture withTooltip' data-placement='bottom' data-toggle='tooltip' href='javascript:;' title='João Tigre'>
                      <img alt='João Tigre' class='img-responsive' src='images/f01.jpg'>
                    </a>
                  </li>
                  <li>
                    <a class='friendPicture withTooltip' data-placement='bottom' data-toggle='tooltip' href='javascript:;' title='João Tigre'>
                      <img alt='João Tigre' class='img-responsive' src='images/f06.jpg'>
                    </a>
                  </li>
                  <li>
                    <a class='friendPicture withTooltip' data-placement='bottom' data-toggle='tooltip' href='javascript:;' title='João Tigre'>
                      <img alt='João Tigre' class='img-responsive' src='images/f07.jpg'>
                    </a>
                  </li>
                  <li>
                    <a class='friendPicture addMore' href='#' title='Adicionar amigo'>
                      <i class='fa fa-plus'></i>
                    </a>
                  </li>
                </ul>
              </div>
-->
              <div class='col-md-6 pull-right'>
                <div class='challengeDate'>
                  <i class='fa fa-calendar-o'></i>
                  <%= @objective.start_day.to_date %> - <%= @objective.end_day.to_date %>
                </div>
              </div>
            </div>
          </div>



          <div class='container'>
            <div class='row'>
              <div class='col-md-12'>
              </div>
            </div>
          </div>
          <div class='container addSavings'>
            <div class='row'>
              <div class='col-md-4 col-md-offset-4'>
				<%if @objective.missing_value != 0 %>
					<div class='addSavings-header'>
	                  <h1 class='secondary'>Faltam</h1>
	                  <h1 class='main'><%= number_to_currency(@objective.missing_value, :unit => "&euro;".html_safe, :format => "%n %u", :separator => ".", :delimiter => " ", :precision => 2) %></h1>
	                </div>   
	                <div class='addSavings-body'>
	                  <p>Quanto poupaste hoje?</p>
						  <%= form_tag "/objectives/#{ @objective.id }/add_value/", method: "post" do %>
						    <div class="savingInput">
						      <input type="text" name="value">
							  <span class='currencySymbol'>€</span>
						    </div>
						    <div class="descriptionInput">
						      <input type="text" name="description" placeholder='Descrição (opcional)'>
						    </div>
						    <div class="actions">
						      <input type="submit" class="sr-only">
						    </div>
							<p class='helpText'>
		                      Pressione enter para adicionar a poupança
		                    </p>
					  <% end %>
					</div>
				<% else %>
	                <div class='addSavings-header'>
	                  <h1 class='secondary'>Objectivo Concluido</h1>
	                </div>
                <%end%>
              </div>
            </div>
          </div>
        </div>
      </article>
      <!-- ### End Add savings ### -->
      
      
      
      
      
      <!-- ### Challenge Activity ### -->
      <article class='challengeActivity'>
        <div class='container'>
          <div class='row'>
          
            <div class='col-md-6'>
              <div class='row'>
                <div class='col-md-12' id='challengeGraph'>
                <%if @labelsset.length > 1%>
                  <canvas id='lineChart'></canvas>
                <%end%>
                </div>
               
               
               
                <div class='col-md-12 userEntries'>
                  <div class='modalBox'>
                    <div class='header'>
                      <h1 class='h5'>
                        Diário de bordo
                        <small>Últimas entradas</small>
                      </h1>
                    </div>
                    <div class='body'>
                    
				                    
				      <% @objective.objective_values.reverse!.each do |value| %>
						  <div class='newEntry'>
	                        <i class='fa fa-eur green'></i>
	                        <p <% unless value.description.blank? %> class='entryText withTooltip' data-placement='top' data-toggle='tooltip' title='<%=value.description%>'<%else%> class="entryText" <%end%> >
	                          Adicionaste
	                          <span class='bold'><%= number_to_currency(value.value, :unit => "&euro;".html_safe, :format => "%n %u", :separator => ".", :delimiter => " ", :precision => 2) %></span>
	                          ao desafio
	                        </p>
	                        <%= link_to '<i class="fa fa-times"></i>'.html_safe, remove_value_path(value), :class => "deleteEntry", data: { confirm: 'Are you sure?' } if user_signed_in? && @objective.user_id == current_user.id %> 
	                        <time><%= time_ago_in_words(value.created_at)%></time>
	                      </div>
  				      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            
            
             <div class='col-md-6 comments'>
              <div class='headerOut'>
                <h1 class='h5'>
                  Actividade
                  <small>Dá a tua opinião sobre o desafio</small>
                </h1>
              </div>
              <div class='modalBox'>
                <div class='body'>
                  <div class='commentBox'>
                    <img class='comment-avatar' src='images/f02.jpg'>
                    <div class='comment-body'>
                      <div class='comment-by'>
                        <a href='#'>Cheryl Howell</a>
                      </div>
                      <p class='comment-text'>
                        Nunca pensei que conseguisses chegar tão longe, superaste tudo e todos com a tua força de vontade!
                      </p>
                      <div class='comment-actions'>
                        <time>29 JUL</time>
                        <a class='pull-right' href='#'>
                          <i class='fa fa-times'></i>
                          Remover
                        </a>
                      </div>
                    </div>
                  </div>
                  <div class='commentBox'>
                    <img class='comment-avatar' src='images/f01.jpg'>
                    <div class='comment-body'>
                      <div class='comment-by'>
                        <a href='#'>Ronald Morales</a>
                      </div>
                      <p class='comment-text'>
                        Não podes perder as viagens de balão junto da praia :)
                      </p>
                      <div class='comment-actions'>
                        <time>4 H</time>
                        <a class='pull-right' href='#'>
                          <i class='fa fa-times'></i>
                          Remover
                        </a>
                      </div>
                    </div>
                  </div>
                  <div class='commentBox'>
                    <img class='comment-avatar' src='images/f06.jpg'>
                    <div class='comment-body'>
                      <div class='comment-by'>
                        <a href='#'>Rebecca Tran</a>
                      </div>
                      <p class='comment-text'>
                        Visita este link, tem as melhores informações de Ibiza: http://pt.wikipedia.org/wiki/Ibiza
                      </p>
                      <div class='comment-actions'>
                        <time>1 H</time>
                        <a class='pull-right' href='#'>
                          <i class='fa fa-times'></i>
                          Remover
                        </a>
                      </div>
                    </div>
                  </div>
                  <div class='newComment'>
                    <form role='form'>
                      <div class='commentArea'>
                        <img class='avatar' src='images/f05.jpg'>
                        <div class='inputWrap'>
                          <textarea name='comment' placeholder='Escreve um comentário…' type='text'></textarea>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class='row'>
            <div class='col-md-6 pull-right'>
              <div class='share-report'>
                <p class='share'>Partilhar</p>
                <a href='#'>
                  <i class='fa fa-2x fa-facebook-square'></i>
                </a>
                <a href='#'>
                  <i class='fa fa-2x fa-twitter-square'></i>
                </a>
                <a href='#'>
                  <i class='fa fa-2x fa-google-plus-square'></i>
                </a>
                <a class='report' href='#'>Denunciar utilizador/desafio</a>
              </div>
            </div>
          </div>
        </div>

      </article>
      <!-- ### end of Challenge Infos ### -->
    </section>


<% content_for :js do %>
<%= javascript_include_tag "Chart.min.js" %>

<script>



var lineChartData = {
	labels : ["<%= @labelsset.map{ |date| "#{time_ago_in_words(date)} ago" }.join('", "').html_safe %>"],    
	datasets: [{
		label: "Savings Graph",
		fillColor : "rgba(220,220,220,0.2)",
		strokeColor : "rgba(220,220,220,1)",
		pointColor : "rgba(220,220,220,1)",
		pointStrokeColor : "#fff",
		pointHighlightFill : "#fff",
		pointHighlightStroke : "rgba(220,220,220,1)",
		data : [<%= @dataset.join(", ") %>]

		}]
};

var options = {
	animation : true
};




//Get the context of the canvas element we want to select
var c = $('#lineChart');
var ct = c.get(0).getContext('2d');
var ctx = document.getElementById("lineChart").getContext("2d");
/*************************************************************************/

//Run function when window resizes
$(window).resize(respondCanvas);

function respondCanvas() {
    c.attr('width', $("#challengeGraph").width());
    c.attr('height', $("#challengeGraph").height());
    //Call a function to redraw other content (texts, images etc)
    myNewChart = new Chart(ct).Line(lineChartData, options);
}

//Initial call
window.onload = function(){
	respondCanvas();
};




</script>
<% end %>